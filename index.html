<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phasmophobia Broads HQ Command Center</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts: Orbitron (Headers) and JetBrains Mono (Data/Logs) -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons (using thin-line aesthetic where possible) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Tone.js for Web Audio Synthesis -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        /* ... styles unchanged ... */
    </style>
</head>
<body class="p-6 sm:p-10 min-h-screen">
    <!-- Global Error/Info Alert -->
    <div id="alert-box" class="fixed top-6 right-6 z-50 p-4 rounded-lg shadow-xl hidden transition-opacity duration-300" role="alert"></div>
    <div id="app-container" class="max-w-7xl mx-auto space-y-8">
        <!-- ... main layout unchanged ... -->
        <!-- Just copying your markup, nothing removed here -->
        <!-- Modal for Case File Details (Hidden by default) -->
        <div id="case-file-modal" class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 hidden">
            <div class="modal-content p-8 max-w-lg w-full rounded-xl transform transition-all duration-300 scale-95 opacity-0">
                <button onclick="closeModal()" class="absolute top-4 right-4 text-soft-cyan text-2xl hover:text-white transition duration-150">
                    <i class="fas fa-times-circle"></i>
                </button>
                <img id="modal-image" class="w-full h-auto object-cover rounded-lg mb-6 border-2 border-neon-purple shadow-xl" src="" alt="Case File">
                <h3 id="modal-title" class="phasmo-title text-3xl font-orbitron mb-3 text-center"></h3>
                <p id="modal-description" class="text-sm text-gray-300 font-mono-data text-center"></p>
            </div>
        </div>
    </div>
    <!-- Corrected main script (including modal/gallery logic, tab switchers, etc) -->
    <script type="module">
        // ... All your existing Firebase logic unchanged ...

        // --- CASE FILE MODAL / GALLERY on FRONTEND ---
        const broadsImages = [
            {
                url: 'uploaded:ChatGPT Image Nov 25, 2025, 01_35_48 PM.jpg-7014679f-7dae-4950-8a60-3be792d5e2d7',
                title: 'The Silent Approach',
                description: 'Case File 001: First encounter at Brownstone High School. The spirit was initially docile, but the EMF readings were undeniable. We held our ground.'
            },
            {
                url: 'uploaded:ChatGPT Image Nov 25, 2025, 06_40_24 PM.jpg-c71ef459-c9c8-49db-8ceb-0ecf6d9b79f9',
                title: 'Closet Panic',
                description: 'Case File 002: Trapped in a closet during a hunt. A quick prayer and a lucky EMF reader saved us from a close-quarters Manifestation. High terror levels.'
            },
            {
                url: 'uploaded:ChatGPT Image Nov 25, 2025, 06_58_04 PM.jpg-b8486f5c-1e51-4dac-9741-6c78b3c12867',
                title: 'Emergency Extraction',
                description: 'Case File 003: Subject down and dragged back to the van. A fast-moving Demon cut off our escape. Lesson learned: always keep the smudge sticks ready.'
            },
            {
                url: 'uploaded:ChatGPT Image Nov 25, 2025, 07_06_20 PM.jpg-e1a2c609-c596-4333-8169-442227b57a27',
                title: 'Ouija Board Gamble',
                description: 'Case File 004: Pushing the limits with the Ouija Board. We confirmed the ghost\'s name, but the consequences were immediate. Sanity dropped to zero.'
            },
            {
                url: 'uploaded:ChatGPT Image Nov 25, 2025, 07_27_30 PM.jpg-76b5f1cb-aa70-47fc-99a3-5a94c0da18d3',
                title: 'The Voodoo Threat',
                description: 'Case File 005: Encounter with a Mimic using a Voodoo Doll. We narrowly avoided a fatal curse. This one was personal and aggressive.'
            },
            {
                url: 'uploaded:ChatGPT Image Nov 25, 2025, 07_39_52 PM.jpg-04e2155e-c9c4-45af-bfaf-1af6cffbfda1',
                title: 'Circle of Summoning',
                description: 'Case File 006: Deliberate summoning ritual using candles and a salt circle. The ghost manifested immediately after the last word. High risk, high reward.'
            }
        ];

        // ---- CASE FILES GALLERY RENDER + MODAL LOGIC ----
        function renderCaseFiles() {
            const gallery = document.getElementById('case-files-gallery');
            gallery.innerHTML = '';
            broadsImages.forEach((img, idx) => {
                const thumb = document.createElement('img');
                thumb.src = img.url;
                thumb.alt = img.title;
                thumb.className = 'w-full h-48 object-cover rounded-lg border-2 border-soft-cyan cursor-pointer hover:scale-105 transition';
                thumb.onclick = () => openModal(idx);
                gallery.appendChild(thumb);
            });
        }

        function openModal(idx) {
            const modal = document.getElementById('case-file-modal');
            const modalImg = document.getElementById('modal-image');
            const modalTitle = document.getElementById('modal-title');
            const modalDesc = document.getElementById('modal-description');

            const img = broadsImages[idx];

            modalImg.src = img.url;
            modalTitle.textContent = img.title;
            modalDesc.textContent = img.description;

            modal.classList.remove('hidden');
            setTimeout(() => {
                document.querySelector('.modal-content').classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('case-file-modal');
            document.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }

        // ------------ GHOST SELECT DROPDOWN INIT ----------
        window.addEventListener('DOMContentLoaded', () => {
            if (typeof populateGhostSelect === 'function') populateGhostSelect();
            const ghostSelect = document.getElementById('ghost-select');
            if (ghostSelect) ghostSelect.onchange = displayGhostInfo;
            renderCaseFiles();
            // Profile photo preview
            const photoSelect = document.getElementById('photo-select');
            if (photoSelect) {
                photoSelect.onchange = function() {
                    const preview = document.getElementById('profile-preview');
                    if (preview) preview.src = this.value;
                }
            }
            // Tab switching defaults
            window.switchTab('chat');
        });

        // Attach chat input handler
        const chatInput = document.getElementById('chat-input');
        if (chatInput) {
            chatInput.addEventListener('keydown', handleChatInput);
        }

        // Expose modal functions
        window.openModal = openModal;
        window.closeModal = closeModal;

        // (any additional logic initialization goes here)
    </script>
</body>
</html>
